$.fn.imagify=function(e){$.each(this,function(r,i){let n=$(i),o=$.fn.imagify.uuid(),a=$.fn.imagify.uuid(),t=$.fn.imagify.uuid(),l=$.extend({style:"border: 1px solid #ccc;",minSize:n.attr("data-min-file-size")||0,maxSize:n.attr("data-max-file-size")||1,maxSizeErrorMessage:"Imagify : Max size error !",minSizeErrorMessage:"Imagify : Min size error !",maxWidth:n.attr("data-max-width")||2e3,minWidth:n.attr("data-min-width")||1,maxHeight:n.attr("data-max-height")||3e3,minHeight:n.attr("data-min-height")||1,dimensionErrorMessage:"Imagify : Dimension error",allowedExt:n.attr("data-allowed-file-extensions")||"jpg jpeg png",allowedExtErrorMessage:"Imagify : Not allowed image extension !",showThumb:!0,feedElement:!0,chooseText:"Choose Image",changeFileText:"Change Image",showImageLabel:!0,onInit:null,onSuccess:null,onError:null,onDimensionError:null,onMinSizeError:null,onMaxSizeError:null,onAllowedExtError:null},e);n.html(`<div class="image-preview" id="${a}" style="${l.style}"><label for="image-input" id="${t}" class="image-label">${l.chooseText}</label><input type="file" id="${o}" name="image" class="image-input" /></div>`),n.attr("data-src")&&n.removeAttr("data-src");let s="#"+o,m="#"+a,g="#"+t;if(!(window.File&&window.FileList&&window.FileReader))return alert("You need a browser with file reader support !"),!1;void 0!==$(s)&&null!==$(s)&&(l.onInit&&l.onInit(n),$(document).on("change",s,function(){let e=this.files;if(e.length>0){let r=e[0];if(r.size>1024*l.maxSize*1024)return l.onMaxSizeError&&l.onMaxSizeError(r),l.onError?l.onError($.fn.imagify.MAX_SIZE_ERROR):console.error(l.maxSizeErrorMessage),!1;if(r.size<1024*l.minSize*1024)return l.onMinSizeError&&l.onMinSizeError(r),l.onError?l.onError($.fn.imagify.MIN_SIZE_ERROR):console.error(l.minSizeErrorMessage),!1;let i=new Image,o=new FileReader;o.addEventListener("load",function(e){let o=e.target,a=!1;i.src=o.result,i.onload=function(){let e=l.allowedExt.split(" ");return $.each(e,function(e,i){if(r.type.match(i))return a=!0,!1}),a?i.width>l.maxWidth||i.height>l.maxHeight||i.width<l.minWidth||i.height<l.minHeight?(l.onDimensionError&&l.onDimensionError(r),l.onError?l.onError($.fn.imagify.DIMENSION_ERROR):console.error(l.dimensionErrorMessage),!1):(l.feedElement&&n.attr("data-src",o.result),l.showThumb&&($(m).css("background-image","url("+o.result+")"),$(m).css("background-size","cover"),$(m).css("background-position","center center")),l.onSuccess&&l.onSuccess($(n[0]),o.result,$(m)),void(l.showImageLabel&&l.showThumb&&$(g).html(l.changeFileText))):(l.onAllowedExtError&&l.onAllowedExtError(r),l.onError?l.onError($.fn.imagify.ALLOWED_EXT_ERROR):console.error(l.allowedExtErrorMessage),!1)}}),o.readAsDataURL(r),$.fn.imagify.clean(s)}else l.showImageLabel&&$(g).html(l.chooseText),$(m).css("background-image","none")}))})},$.fn.imagify.MAX_SIZE_ERROR=1,$.fn.imagify.DIMENSION_ERROR=2,$.fn.imagify.MIN_SIZE_ERROR=3,$.fn.imagify.ALLOWED_EXT_ERROR=4,$.fn.imagify.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let r=16*Math.random()|0;return("x"==e?r:3&r|8).toString(16)})},$.fn.imagify.clean=function(e,r){$(e).val(null)};
